<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actividad 9 (09/02/2022)</title>
    <!--

        Usted como encargado de la creación de una página web de registro de personas para una acitividad de turismo. Se le ha solicitado un formulario para registrar los siguientes datos:
    Nombre
    Edad
    Peso
    Condicion de salud
    Alergias
    
Importante: Solamente usando la consola.

1) Lista de personas mayores de 18 años
2) Cantidad de personas con peso mayor de 90 kg 
3) Entregar el promedio de edad de todos los asistentes
4) Mostrar los nombres de las personas alfabéticamente
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <style>
        caption {
            caption-side: top;
            text-align: center;
        }
    </style>

</head>

<body>
    <header></header>
    <article>
<div class="container">
        <form class="row g-3 needs-validation" novalidate method="get" action="" id="form">
            <fieldset>
                <legend>Información Personal</legend>
                <div class="form-group">
                    <label for="nombre">Nombres</label>
                    <input id="nombre" name="nombre" maxlength="25" required type="text" class="form-control"
                        autocapitalize="words" autocomplete="given-name" placeholder="Ingrese sus nombres"
                        pattern="([\w]+)" />
                    <div class="invalid-feedback">Ingrese sus nombres</div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="edad">Edad</label>
                            <input id="edad" name="edad" required type="number" min="1" max="110" class="form-control"
                                placeholder="Ingrese su edad" />
                            <div class="invalid-feedback">Ingrese su edad</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="edad">Peso</label>
                                <input id="peso" name="peso" required type="number" min="1" max="110"
                                    class="form-control" placeholder="Ingrese su peso" />
                                <div class="invalid-feedback">Ingrese su peso</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label for="edad">Condicion de Salud</label>
                                    <input id="csalud" name="csalud" required type="text" min="1" max="110"
                                        class="form-control" placeholder="Ingrese su condición de salud" />
                                    <div class="invalid-feedback">Ingrese su condición de salud</div>
                                </div>
                            </div>

                            <div class="col">
                                <div class="form-group">
                                    <label for="lalergico">¿Es Al&eacute;rgico?</label><br />
                                    <div
                                        style="flex-direction: row;align-content: center;justify-content: space-evenly;display: flex;">
                                        <div class="form-check form-check-inline">
                                            <input id="alergicosi" required class="form-check-input" name="alergico"
                                                type="radio" value="si" required />
                                            <label class="form-check-label" for="alergicosi">Si</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input id="alergicono" class="form-check-input" name="alergico" type="radio"
                                                value="no" required />
                                            <label class="form-check-label" for="alergicono">No</label>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback">Debe indicar si es al&eacute;rgico</div>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <div class="col">&nbsp;</div>
                        </div>
                        <div class="row">
                            <div class="col">&nbsp;</div>
                            <div class="col-6" style="display: flex;flex-direction:row;">
                                <input type="submit" class="btn btn-primary" id="enviar" value="Enviar"
                                    style="flex: 1;" />
                            </div>
                            <div class="col">&nbsp;</div>
                        </div>

            </fieldset>
        </form>
        <br />
        <hr /><br />
        <div class="row" style="display:flex;flex-direction:row">
            <table class="table">
                <caption>
                    <h2>Registros</h2>
                </caption>
                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Edad</th>
                        <th scope="col">Peso</th>
                        <th scope="col">Condición de salud</th>
                        <th scope="col">¿Es alergico?</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <table class="table">
                <caption>
                    <h2>Resumen</h2>
                </caption>
                <thead>
                    <tr>
                        <th scope="col">Cantidad de personas mayores de 18</th>
                        <td id="pmayores"></td>
                    </tr>
                    <tr>
                        <th scope="col">Edad promedio</th>
                        <td id="pedad"></td>
                    </tr>
                    <tr>
                        <th scope="col">Cantidad de personas con peso mayor de 90 kg</th>
                        <td id="ppeso"></td>
                    </tr>
                    <tr>
                        <th scope="col">Mostrar los nombres de las personas alfabéticamente</th>
                        <td id="pnombres"></td>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    </article>
    <script>
        document.getElementById("form").addEventListener("submit", (event) => {
            event.preventDefault()
            event.stopPropagation()
            let resultado = JSON.parse(localStorage.getItem("resultado"));
            if (form.checkValidity()) {

                let data = jQuery(document.querySelector('form')).serializeArray().reduce((res, it) => { res[it.name] = it.value; return res; }, {});

                if (resultado == null) {
                    resultado = [data]
                    localStorage.setItem("resultado", JSON.stringify(resultado));
                }
                else {
                    resultado.push(data);
                    localStorage.setItem("resultado", JSON.stringify(resultado));
                }
                form.reset();
                alert("Datos guardados")
                genTabla();
            }
            console.log("Lista de personas mayores de 18 años")
            console.table(resultado.filter(i => parseInt(i.edad) > 18).map(i => i.nombre));
            console.log("Cantidad de personas con peso mayor de 90 kg", resultado.filter(i => parseInt(i.peso) > 90).length);
            console.log("Entregar el promedio de edad de todos los asistentes", resultado.reduce((a, b) => a + parseInt(b.edad), 0) / resultado.length);
            console.log("Mostrar los nombres de las personas alfabéticamente", resultado.map(i => i.nombre).sort().reverse());
            //form.classList.add('was-validated')
        })


        window.addEventListener('storage', () => {
            console.log(JSON.parse(window.localStorage.getItem('resultado')));
            genTabla();
        });
        function genFilaTabla(row, i) {//{nombre: 'Wladimir Alejandro ', edad: '38', peso: '99', csalud: 'covid', alergico: 'si'}
            const tr = document.createElement("tr");
            const tdId = document.createElement("td"); tdId.textContent = i;
            const tdNombre = document.createElement("td"); tdNombre.textContent = row.nombre;
            const tdEdad = document.createElement("td"); tdEdad.textContent = row.edad;
            const tdPeso = document.createElement("td"); tdPeso.textContent = row.peso;
            const tdCSalud = document.createElement("td"); tdCSalud.textContent = row.csalud;
            const tdAlergico = document.createElement("td"); tdAlergico.textContent = row.alergico;
            tr.appendChild(tdId);
            tr.appendChild(tdNombre);
            tr.appendChild(tdEdad);
            tr.appendChild(tdPeso);
            tr.appendChild(tdCSalud);
            tr.appendChild(tdAlergico);
            return tr;
        }
        function genTabla() {
            let data = JSON.parse(window.localStorage.getItem('resultado'));
            [...document.querySelector("tbody").children].forEach((i) => document.querySelector("tbody").removeChild(i));
            if (data.length > 0) {
                data.forEach((persona, ind) => document.querySelector("tbody").appendChild(genFilaTabla(persona, ind)));
            }
            else {
                document.querySelector("tbody").innerHtml = "<p>Sin Datos ingresados aun</p>"
            }
            document.getElementById("pmayores").textContent=data.filter(i => parseInt(i.edad) > 18).map(i => i.nombre).join(" , ");
            document.getElementById("ppeso").textContent=data.filter(i => parseInt(i.peso) > 90).length;
            document.getElementById("pedad").textContent= Math.round( data.reduce((a, b) => a + parseInt(b.edad), 0) / data.length);
            document.getElementById("pnombres").textContent= data.map(i => i.nombre).sort().reverse().join(" , ")

        }
        genTabla()

    </script>
</body>

</html>